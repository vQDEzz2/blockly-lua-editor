<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roblox Blockly Studio</title>
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Blockly Core -->
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    
    <!-- Blockly Blocks -->
    <script src="https://unpkg.com/blockly/blocks/blocks.min.js"></script>
    
    <!-- Blockly Language Generators -->
    <script src="https://unpkg.com/blockly/javascript/javascript.js"></script>
    <script src="https://unpkg.com/blockly/lua/lua.js"></script>
    
    <!-- Ace Editor -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.22.1/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.22.1/mode-lua.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.22.1/theme-monokai.js"></script>
    
    <!-- Custom Scripts -->
    <script src="js/blocks.js" defer></script>
    <script src="js/generators.js" defer></script>
    <script src="js/toolbox.js" defer></script>
    <script src="js/workspace.js" defer></script>
</head>
<body class="theme-light">
    <!-- Rest of your HTML remains the same -->
    <div id="blocklyDiv" style="height: 480px; width: 100%;"></div>
    <div id="luaOutput" style="height: 200px; width: 100%;"></div>

    <!-- Toolbox Definition -->
    <xml id="toolbox" style="display: none">
        <category name="Roblox" colour="#FF4444">
            <block type="roblox_print"></block>
            <block type="roblox_wait"></block>
        </category>
        <!-- Add more categories as needed -->
    </xml>

    <script>
        // Initialize workspace when page loads
        window.addEventListener('load', function() {
            // Create main workspace
            const workspace = Blockly.inject('blocklyDiv', {
                toolbox: document.getElementById('toolbox'),
                grid: {
                    spacing: 20,
                    length: 3,
                    colour: '#ccc',
                    snap: true
                },
                zoom: {
                    controls: true,
                    wheel: true,
                    startScale: 1.0,
                    maxScale: 3,
                    minScale: 0.3,
                    scaleSpeed: 1.2
                },
                trashcan: true
            });

            // Initialize Ace editor for Lua output
            const editor = ace.edit("luaOutput");
            editor.setTheme("ace/theme/monokai");
            editor.session.setMode("ace/mode/lua");
            editor.setReadOnly(true);

            // Add change listener to update Lua code
            workspace.addChangeListener(function() {
                try {
                    const code = Blockly.Lua.workspaceToCode(workspace);
                    editor.setValue(code, -1);
                } catch (e) {
                    console.error('Error generating code:', e);
                    editor.setValue('// Error generating code: ' + e.message);
                }
            });
        });
    </script>
</body>
</html>
