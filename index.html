<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lua Block Programming</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/9.3.3/blockly.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/9.3.3/blocks.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/9.3.3/lua.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        #blocklyDiv {
            height: 600px;
            width: 100%;
        }
        .controls {
            padding: 1rem;
            background: #f0f0f0;
            border-bottom: 1px solid #ddd;
        }
        #codeOutput {
            padding: 1rem;
            background: #2d2d2d;
            color: #fff;
            font-family: monospace;
            white-space: pre;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button onclick="generateCode()">Generate Lua Code</button>
        <button onclick="runCode()">Run Code</button>
    </div>
    <div id="blocklyDiv"></div>
    <div id="codeOutput"></div>

    <xml id="toolbox" style="display: none">
        <category name="Logic" colour="%{BKY_LOGIC_HUE}">
            <block type="controls_if"></block>
            <block type="logic_compare"></block>
            <block type="logic_operation"></block>
            <block type="logic_negate"></block>
        </category>
        <category name="Loops" colour="%{BKY_LOOPS_HUE}">
            <block type="controls_repeat_ext"></block>
            <block type="controls_whileUntil"></block>
            <block type="controls_for"></block>
        </category>
        <category name="Math" colour="%{BKY_MATH_HUE}">
            <block type="math_number"></block>
            <block type="math_arithmetic"></block>
            <block type="math_single"></block>
        </category>
        <category name="Text" colour="%{BKY_TEXTS_HUE}">
            <block type="text"></block>
            <block type="text_print"></block>
            <block type="text_join"></block>
        </category>
        <category name="Roblox" colour="#FF4F4F">
            <block type="roblox_wait">
                <value name="SECONDS">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
            </block>
            <block type="roblox_print"></block>
            <block type="roblox_get_player"></block>
            <block type="roblox_move_player"></block>
        </category>
    </xml>

    <script>
        // Initialize Blockly
        const workspace = Blockly.inject('blocklyDiv', {
            toolbox: document.getElementById('toolbox'),
            grid: {
                spacing: 20,
                length: 3,
                colour: '#ccc',
                snap: true
            },
            zoom: {
                controls: true,
                wheel: true,
                startScale: 1.0,
                maxScale: 3,
                minScale: 0.3,
                scaleSpeed: 1.2
            },
            trashcan: true
        });

        // Define custom Roblox-like blocks
        Blockly.Blocks['roblox_wait'] = {
            init: function() {
                this.appendValueInput('SECONDS')
                    .setCheck('Number')
                    .appendField('wait');
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour('#FF4F4F');
                this.setTooltip('Waits for the specified number of seconds');
            }
        };

        Blockly.Blocks['roblox_print'] = {
            init: function() {
                this.appendValueInput('MESSAGE')
                    .setCheck(null)
                    .appendField('print');
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour('#FF4F4F');
                this.setTooltip('Prints a message to the output');
            }
        };

        Blockly.Blocks['roblox_get_player'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField('get local player');
                this.setOutput(true, null);
                this.setColour('#FF4F4F');
                this.setTooltip('Gets the local player');
            }
        };

        Blockly.Blocks['roblox_move_player'] = {
            init: function() {
                this.appendValueInput('PLAYER')
                    .setCheck(null)
                    .appendField('move player');
                this.appendValueInput('X')
                    .setCheck('Number')
                    .appendField('x');
                this.appendValueInput('Y')
                    .setCheck('Number')
                    .appendField('y');
                this.appendValueInput('Z')
                    .setCheck('Number')
                    .appendField('z');
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour('#FF4F4F');
                this.setTooltip('Moves the player to specified coordinates');
            }
        };

        // Define Lua code generators for custom blocks
        Blockly.Lua['roblox_wait'] = function(block) {
            const seconds = Blockly.Lua.valueToCode(block, 'SECONDS', Blockly.Lua.ORDER_ATOMIC) || '0';
            return `wait(${seconds})\n`;
        };

        Blockly.Lua['roblox_print'] = function(block) {
            const message = Blockly.Lua.valueToCode(block, 'MESSAGE', Blockly.Lua.ORDER_ATOMIC) || "''";
            return `print(${message})\n`;
        };

        Blockly.Lua['roblox_get_player'] = function(block) {
            return ['game.Players.LocalPlayer', Blockly.Lua.ORDER_ATOMIC];
        };

        Blockly.Lua['roblox_move_player'] = function(block) {
            const player = Blockly.Lua.valueToCode(block, 'PLAYER', Blockly.Lua.ORDER_ATOMIC) || 'game.Players.LocalPlayer';
            const x = Blockly.Lua.valueToCode(block, 'X', Blockly.Lua.ORDER_ATOMIC) || '0';
            const y = Blockly.Lua.valueToCode(block, 'Y', Blockly.Lua.ORDER_ATOMIC) || '0';
            const z = Blockly.Lua.valueToCode(block, 'Z', Blockly.Lua.ORDER_ATOMIC) || '0';
            return `${player}.Character:MoveTo(Vector3.new(${x}, ${y}, ${z}))\n`;
        };

        function generateCode() {
            const code = Blockly.Lua.workspaceToCode(workspace);
            document.getElementById('codeOutput').textContent = code;
        }

        function runCode() {
            const code = Blockly.Lua.workspaceToCode(workspace);
            // In a real implementation, this would run the Lua code
            alert('Code execution is simulated. In a real environment, this would run the Lua code.');
            console.log('Generated Lua code:', code);
        }
    </script>
</body>
</html>
